define(["lib/react","lib/clib"],function(e,t){var n=e.DOM,r=120;return e.createClass({displayName:"Chat",propTypes:{engine:e.PropTypes.object.isRequired},getInitialState:function(){return this.listLength=this.props.engine.chat.length,{}},copyGameInfo:function(e){return function(){window.prompt("Copy to clipboard: Ctrl+C, Enter","ID: "+e.game_id+"\n Hash: "+e.hash+"\n Seed hash: "+e.seed_hash)}},render:function(){var e=this,r=this.props.engine.chat.map(function(r,i){var s,o;switch(r.pri){case-2:s="msg-bad",o="fa fa-bomb";break;case-1:s="msg-warn",o="fa fa-warning";break;case 0:s="msg-message",o="fa fa-dot-circle-o";break;case 1:s="msg-neutral",o="fa fa-spinner";break;case 2:s="msg-good",o="fa fa-money";var u;r.winner?u=[n.span({key:"usr-txt"}," - User "),n.a({href:"/user/"+r.winner,target:"_blank",key:"usr-lnk"},r.winner),n.span({key:"usr-bns"}," got "+t.formatSatoshis(r.bonus)+" bonus")]:u=null;break;case 3:s="msg-notice",o="fa fa-gamepad";break;case 4:return s="msg-game-info",o="fa fa-info",n.li({className:s+" hint--bottom",key:"msg"+i,rel:"tooltip","data-hint":"Click to copy game info",onClick:e.copyGameInfo(r)},n.i({className:o},null)," "+r.msg);default:return s="msg-chat-message",o="",n.li({className:s,key:"msg"+i},n.i({className:o},null),n.a({href:"/user/"+r.username,target:"_blank"},"<"+r.username+">")," "+r.message)}}),i;return this.props.engine.username?i=n.input({className:"chat-input",onKeyDown:this.sendMessage,ref:"input",placeholder:"Type here..."}):i=n.input({className:"chat-input",onKeyDown:this.sendMessage,ref:"input",placeholder:"Log in to chat...",disabled:!0}),n.div({className:"messages-container"},n.ul({className:"messages",ref:"messages"},r),i)},sendMessage:function(e){if(e.keyCode==13){var t=this.refs.input.getDOMNode().value;t.length>1&&t.length<500&&(this.props.engine.say(t,function(e){console.log("Error sending message",e)}),this.refs.input.getDOMNode().value="")}},shouldComponentUpdate:function(e,t){return e.engine.chat.length!=this.listLength?(this.listLength=e.engine.chat.length,!0):!1},componentDidUpdate:function(){var e=this.refs.messages.getDOMNode(),t=e.scrollHeight-e.offsetHeight-e.scrollTop;t<r&&(e.scrollTop=e.scrollHeight)},componentDidMount:function(){var e=this.refs.messages.getDOMNode();e.scrollTop=e.scrollHeight}})});